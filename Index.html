<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <!-- Special version of Bootstrap that only affects content wrapped in .bootstrap-iso -->
    <link rel="stylesheet" href="https://formden.com/static/cdn/bootstrap-iso.css" /> 
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue"></script>
    
    <!-- Inline CSS based on choices in "Settings" tab -->
    <style>.bootstrap-iso .formden_header h2, .bootstrap-iso .formden_header p, 
      .bootstrap-iso form{font-family: Arial, Helvetica, sans-serif; color: black}
      .bootstrap-iso form button, .bootstrap-iso form button:hover{color: white !important;} 
      .asteriskField{color: red;}
     </style>
  </head>
  <body>
  
  <p><img src="https://drive.google.com/uc?export=download&id=1ogUtDpuTv2Z3cUoJlN3D_JaWMA02Tmz1" width="225" height="75"> </p>
  
  
  <!-- Reference to the vue instance -->
  <div id="fueller-app">
  
  
    <!-- HTML Form (wrapped in a .bootstrap-iso div) -->
    <div class="bootstrap-iso">
     <div class="container-fluid">
      <div class="row">
       <div class="col-md-6 col-sm-6 col-xs-12">
        <form method="post">
         <div class="form-group ">
          <label class="control-label requiredField" for="fuel_card_id">
           Fuel Card Number
           <span class="asteriskField">
            *
           </span>
          </label>
          <input type="number" id="fuelcard-number" name="number" v-model='customer.number' placeholder="00X" >
          <!--<input class="form-control" id="fuel_card_id" name="fuel_card_id" placeholder="00X" type="text"/>-->
          <span class="help-block" id="hint_fuel_card_id">
           Please enter the fuel card number
          </span>
         </div>
          <div class="form-group">
            <div>
              <div class="btn btn-primary" id="find-customer-button">Next</div>
            </div>
          </div>
          <div class="form-group ">
            <div v-if="isAuthorised" class="alert alert-success" role="alert">
              Authorised
            </div>
            <div v-else-if="customerFound" class="alert alert-danger" role="alert">
              NOT Authorised - Request customer to top-up
            </div>
            <div v-else-if="searchPerformed" class="alert alert-danger" role="alert">
              No Customer found for that fuel card number
            </div>
          </div>
        </form>
       </div>
      </div>
     </div>
    </div>

  </div><!-- Reference to the vue instance -->
  
  <script type="text/javascript">
  
  var app = new Vue({
    el: '#fueller-app', 
    data: { 
      customer: {
         number: '', 
         name: '',
         amount: '',
      },      
      customers: [],
      isAuthorised: false,
      customerFound: false,
      searchPerformed: false,
      shortfall: 0
    }  
  }); 
    
 document.querySelector('#find-customer-button').addEventListener('click', function(){
    var customer = {
      number: app.customer.number, 
      amount: app.customer.amount, 
    }; 
  
    google.script.run.withSuccessHandler(onCustomerSearchResult).findCustomer(customer); 
  
  });
  
  function onCustomerSearchResult(response){
 
   if(response.success) {
      app.customer = response.customer; 
      app.isAuthorised = response.isAuthorised;
      if (app.isAuthorised == false) {
        app.shortfall = response.shortfall;
      }
      app.customerFound = response.customerFound;
    } else {
      app.customerFound = false;
      app.isAuthorised = response.isAuthorised;
      app.customerFound = response.customerFound;
    }
    
    app.searchPerformed = true; 
  }  
  
  </script>
  </body>
</html>


